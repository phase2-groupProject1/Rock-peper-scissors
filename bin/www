const app = require("../app");
const http = require("http");
const { Server } = require("socket.io");
const socketController = require("../controllers/socketController");

// normalize port
const PORT = process.env.PORT || 3000

// buat HTTP server dari app
const server = http.createServer(app);

// attach Socket.IO ke server yang sama
const io = new Server(server, {
  cors: { origin: "*", methods: ["GET", "POST"] },
});

// daftarkan handler socket
socketController(io);

// LISTEN di server (bukan app)
server.listen(PORT, () => {
  console.log(`RPS server listening on http://localhost:${PORT}`);
});

// optional handler error/listening
server.on("error", (err) => {
  if (err.code === "EADDRINUSE") {
    console.error(`Port ${PORT} already in use`);
    process.exit(1);
  }
});